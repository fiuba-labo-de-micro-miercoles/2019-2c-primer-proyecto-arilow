.EQU 		SERVO_MAX = 2600
.EQU 		SERVO_MID = 1000
.EQU 		SERVO_MIN = 500
.INCLUDE 	"PCA9685.INC"

MOVEMENT_SETUP:
	RCALL 	PCA9685_SETUP
	LDI 	R23,1
	LDI 	R24,LOW(1000)
	LDI 	R25,HIGH(1000)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY
	LDI 	R23,2
	LDI 	R24,LOW(500)
	LDI 	R25,HIGH(500)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY
	LDI 	R23,3
	LDI 	R24,LOW(1500)
	LDI 	R25,HIGH(1500)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY
	LDI 	R23,4
	LDI 	R24,LOW(500)
	LDI 	R25,HIGH(500)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY
	LDI 	R23,5
	LDI 	R24,LOW(1400)
	LDI 	R25,HIGH(1400)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY
	LDI 	R23,6
	LDI 	R24,LOW(700)
	LDI 	R25,HIGH(700)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY
	LDI 	R23,7
	LDI 	R24,LOW(800)
	LDI 	R25,HIGH(800)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY
	LDI 	R23,8
	LDI 	R24,LOW(500)
	LDI 	R25,HIGH(500)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY
	RET


;R26	POS_LOW		
;R27	POS_HIGH
MOVEMENT_LEG_1:
	LDI 	R23,2
	LDI 	R24,LOW(1000)
	LDI 	R25,HIGH(1000)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY	
	
	LDI 	R23,1
	MOV 	R24,R26
	MOV 	R25,R27
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY

	LDI 	R23,2
	LDI 	R24,LOW(500)
	LDI 	R25,HIGH(500)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY

	RET


;R26	POS_LOW		
;R27	POS_HIGH
MOVEMENT_LEG_2:
	LDI 	R23,4
	LDI 	R24,LOW(1000)
	LDI 	R25,HIGH(1000)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY	
	
	LDI 	R23,3
	MOV 	R24,R26
	MOV 	R25,R27
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY

	LDI 	R23,4
	LDI 	R24,LOW(500)
	LDI 	R25,HIGH(500)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY

	RET

;R26	POS_LOW		
;R27	POS_HIGH
MOVEMENT_LEG_3:
	LDI 	R23,6
	LDI 	R24,LOW(1200)
	LDI 	R25,HIGH(1200)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY	
	
	LDI 	R23,5
	MOV 	R24,R26
	MOV 	R25,R27
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY

	LDI 	R23,6
	LDI 	R24,LOW(700)
	LDI 	R25,HIGH(700)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY

	RET

;R26	POS_LOW		
;R27	POS_HIGH
MOVEMENT_LEG_4:
	LDI 	R23,8
	LDI 	R24,LOW(1000)
	LDI 	R25,HIGH(1000)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY	
	
	LDI 	R23,7
	MOV 	R24,R26
	MOV 	R25,R27
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY

	LDI 	R23,8
	LDI 	R24,LOW(500)
	LDI 	R25,HIGH(500)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY

	RET


MOVEMENT_TEST:	
	LDI 	R23,0
	LDI 	R24,LOW(500)
	LDI 	R25,HIGH(500)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY
	
	LDI 	R23,0
	LDI 	R24,LOW(1000)
	LDI 	R25,HIGH(1000)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY	


	LDI 	R23,1
	LDI 	R24,LOW(1700)
	LDI 	R25,HIGH(1700)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY

	LDI 	R23,0
	LDI 	R24,LOW(500)
	LDI 	R25,HIGH(500)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY
	
	LDI 	R23,0
	LDI 	R24,LOW(1000)
	LDI 	R25,HIGH(1000)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY

	LDI 	R23,1
	LDI 	R24,LOW(1000)
	LDI 	R25,HIGH(1000)
	RCALL 	PCA9685_MOVE
	RCALL 	MOVEMENT_DELAY

	RET


MOVEMENT_DELAY:
	push r22
	push r24
	push r25
	ldi r22, 100 ;
MOVEMENT_OUTER_LOOP:
	ldi r24, low(90)
	ldi r25, high(90)
MOVEMENT_DELAY_LOOP:
	adiw r25:r24,1
	brne MOVEMENT_DELAY_LOOP
	nop
	dec r22
	brne MOVEMENT_OUTER_LOOP
	pop r25
	pop r24
	pop r22
	ret
