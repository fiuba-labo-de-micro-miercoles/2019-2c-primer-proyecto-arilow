.INCLUDE 	"M328PDEF.INC"



.CSEG


.ORG 	0x00
	RJMP	MAIN
.ORG 	0x02
	RJMP 	EXT_INT0
.ORG 	0x1E
	RJMP	TIM1_OVF
.ORG 	0x24
	RJMP 	HC05_RECEPTION_HANDLER
;INTERRUPCIONES







.ORG 	INT_VECTORS_SIZE
MAIN:
INIC_SP:
	ldi r16,low(RAMEND)
	out spl,r16
	ldi r16,high(RAMEND)
	out sph,r16
	

	SBI DDRB,5

	RCALL	INIC_ANGULOS	;INICIALIZA VALORES DE ANGULOS DE LOS SERVOS	

	RCALL	MOVEMENT_SETUP	;SERVOS EN POSICIÓN INICIAL		
	RCALL 	HC05_SETUP
;	RCALL 	HCSR04_SETUP

	
	SEI
	
MAIN_LOOP:
;	RCALL 	MOVEMENT_SWITCH
	RJMP 	MAIN_LOOP

TURN_ON:
	SBI PORTB,5
	RET


TURN_OFF:
	CBI PORTB,5
	RET

;error
ERRLOOP:
	RJMP	ERRLOOP


DELAY_10_S:
	PUSH	R25
	LDI		R25,50
LOOP_DELAY_1_S:
	RCALL	DELAY_100_MS
	DEC	R25
	brne LOOP_DELAY_1_S
	
	POP		R25
	RET

DELAY_100_MS:	;DELAY DE 100 MILISEGUNDOS PARA UN CLOCK DE 1MZ
	push r22
	push r24
	ldi r22, 200 ;
LOOP_DELAY_1:
	ldi R24, 170
LOOP_DELAY_2:
	DEC	R24
	brne LOOP_DELAY_2
	dec r22
	brne LOOP_DELAY_1

	pop r24
	pop r22
	ret


.INCLUDE	"DEFINES.INC"
.INCLUDE	"ANGULOS.INC"
.INCLUDE 	"MOVEMENT.INC"
.INCLUDE 	"HCSR04.INC"
.INCLUDE 	"HC05.INC"
